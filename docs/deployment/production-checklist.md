# Production Checklist

Чеклист для развертывания в продакшене.

## Безопасность

### Переменные окружения

- [ ] Все секреты хранятся в переменных окружения, не в коде
- [ ] Используется сильный `JWT_SECRET` (минимум 32 символа)
- [ ] Пароли БД сложные и уникальные
- [ ] Redis защищен паролем (если доступен извне)

### HTTPS

- [ ] Настроен HTTPS (SSL/TLS сертификат)
- [ ] HTTP редиректится на HTTPS
- [ ] Используется Let's Encrypt или другой валидный сертификат

### Доступ к БД

- [ ] PostgreSQL доступен только изнутри сети
- [ ] Используются firewall правила
- [ ] Отключен публичный доступ к БД

## Конфигурация

### Переменные окружения

- [ ] `APP_ENV=production`
- [ ] `SERVER_HOST=0.0.0.0`
- [ ] Правильные credentials для БД
- [ ] Настроены таймауты
- [ ] Настроены лимиты буфера

### Логирование

- [ ] Логирование настроено на уровень `info` или `warn`
- [ ] Логи сохраняются в файл или централизованную систему
- [ ] Настроена ротация логов

## База данных

### Миграции

- [ ] Все миграции применены
- [ ] Схема БД соответствует коду
- [ ] Созданы необходимые индексы

### Резервное копирование

- [ ] Настроены автоматические бэкапы БД
- [ ] Бэкапы хранятся в безопасном месте
- [ ] Протестировано восстановление из бэкапа

### Производительность

- [ ] Настроен connection pool для PostgreSQL
- [ ] Настроены индексы для частых запросов
- [ ] Мониторится производительность запросов

## Мониторинг

### Health Checks

- [ ] Endpoint `/health` работает корректно
- [ ] Настроен мониторинг health endpoint
- [ ] Настроены алерты при недоступности

### Логи

- [ ] Логи структурированы (JSON)
- [ ] Настроена централизованная система логов
- [ ] Настроены алерты на критические ошибки

### Метрики

- [ ] Собираются метрики производительности
- [ ] Мониторится использование памяти и CPU
- [ ] Настроены дашборды для визуализации

## Масштабирование

### Горизонтальное масштабирование

- [ ] Приложение готово к запуску в нескольких экземплярах
- [ ] Настроен load balancer
- [ ] Сессии хранятся в Redis (shared state)

### Вертикальное масштабирование

- [ ] Настроены лимиты ресурсов (CPU, память)
- [ ] Мониторится использование ресурсов

## Документация

- [ ] API документация актуальна
- [ ] Документированы все endpoints
- [ ] Есть инструкции по развертыванию
- [ ] Документированы переменные окружения

## Тестирование

- [ ] Все тесты проходят
- [ ] Протестированы критические пути
- [ ] Проведено нагрузочное тестирование
- [ ] Протестирована работа при недоступности БД (offline resilience)

## Деплой

### Процесс деплоя

- [ ] Настроен CI/CD pipeline
- [ ] Есть процесс отката (rollback)
- [ ] Деплой не прерывает работу сервиса (zero-downtime)

### Версионирование

- [ ] Используется семантическое версионирование
- [ ] Версии помечаются в Git тегами
- [ ] Версия отображается в health endpoint

## После деплоя

### Проверка

- [ ] Health endpoint возвращает `200 OK`
- [ ] Все основные endpoints работают
- [ ] Нет ошибок в логах
- [ ] Метрики в норме

### Мониторинг

- [ ] Настроены алерты
- [ ] Есть процесс реагирования на инциденты
- [ ] Документированы процедуры восстановления

## Рекомендации

### Производительность

- Используйте CDN для статических файлов
- Настройте кэширование где возможно
- Оптимизируйте SQL запросы

### Надежность

- Настройте автоматический перезапуск при сбоях
- Используйте health checks для автоматического восстановления
- Настройте мониторинг всех зависимостей (БД, Redis)

### Безопасность

- Регулярно обновляйте зависимости
- Проводите security аудиты
- Используйте rate limiting для API

---

**Помните**: Продакшен требует постоянного внимания и мониторинга!

